# Based on Debian (node:14 image)
FROM node:14

ARG PG_2_USER
ARG PG_2_PASSWORD
ARG PG_2_DATABASE
ARG PGHOST
ARG PGHOST2_PRODUCTION
ARG PGPORT
ARG RABBITMQ_URL
ARG RABBITMQ_URL_PRODUCTION
ARG RABBITMQ_QUEUE

ENV PG_2_USER=$PG_2_USER
ENV PG_2_PASSWORD=$PG_2_PASSWORD
ENV PG_2_DATABASE=$PG_2_DATABASE
ENV PGHOST=$PGHOST
ENV PGHOST_PRODUCTION=$PGHOST2_PRODUCTION
ENV PGPORT=$PGPORT
ENV RABBITMQ_URL=$RABBITMQ_URL
ENV RABBITMQ_URL_PRODUCTION=$RABBITMQ_URL_PRODUCTION
ENV RABBITMQ_QUEUE=$RABBITMQ_QUEUE

WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

EXPOSE 8080
CMD ["node", "src/server.js"]
